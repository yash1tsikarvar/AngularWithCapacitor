{
  "version": 3,
  "file": "angulartics2-ga.umd.js",
  "sources": [
    "ng://angulartics2/ga/src/lib/providers/ga/ga.ts"
  ],
  "sourcesContent": [
    "import { Injectable } from '@angular/core';\n\nimport {\n  Angulartics2,\n  GoogleAnalyticsSettings,\n  UserTimings,\n} from 'angulartics2';\n\n\ndeclare var _gaq: GoogleAnalyticsCode;\ndeclare var ga: UniversalAnalytics.ga;\ndeclare var location: any;\n\nexport class GoogleAnalyticsDefaults implements GoogleAnalyticsSettings {\n  additionalAccountNames = [];\n  userId = null;\n  transport = '';\n  anonymizeIp = false;\n}\n\n@Injectable()\nexport class Angulartics2GoogleAnalytics {\n  dimensionsAndMetrics = [];\n\n  constructor(private angulartics2: Angulartics2) {\n    const defaults = new GoogleAnalyticsDefaults();\n    // Set the default settings for this module\n    this.angulartics2.settings.ga = {\n      ...defaults,\n      ...this.angulartics2.settings.ga,\n    };\n    this.angulartics2.pageTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe(x => this.pageTrack(x.path));\n    this.angulartics2.eventTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe(x => this.eventTrack(x.action, x.properties));\n    this.angulartics2.exceptionTrack\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe(x => this.exceptionTrack(x));\n    this.angulartics2.setUsername.subscribe((x: string) => this.setUsername(x));\n    this.angulartics2.setUserProperties.subscribe(x => this.setUserProperties(x));\n    this.angulartics2.userTimings\n      .pipe(this.angulartics2.filterDeveloperMode())\n      .subscribe(x => this.userTimings(x));\n  }\n\n  pageTrack(path: string) {\n    if (typeof _gaq !== 'undefined' && _gaq) {\n      _gaq.push(['_trackPageview', path]);\n      for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n        _gaq.push([accountName + '._trackPageview', path]);\n      }\n    }\n    if (typeof ga !== 'undefined' && ga) {\n      if (this.angulartics2.settings.ga.userId) {\n        ga('set', '&uid', this.angulartics2.settings.ga.userId);\n        for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n          ga(accountName + '.set', '&uid', this.angulartics2.settings.ga.userId);\n        }\n      }\n      if (this.angulartics2.settings.ga.anonymizeIp) {\n        ga('set', 'anonymizeIp', true);\n        for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n          ga(accountName + '.set', 'anonymizeIp', true);\n        }\n      }\n      ga('send', 'pageview', path);\n      for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n        ga(accountName + '.send', 'pageview', path);\n      }\n    }\n  }\n\n  /**\n   * Track Event in GA\n   *\n   * @param action Associated with the event\n   * @param properties Comprised of:\n   *  - category (string) and optional\n   *  - label (string)\n   *  - value (integer)\n   *  - noninteraction (boolean)\n   *\n   * @link https://developers.google.com/analytics/devguides/collection/gajs/eventTrackerGuide#SettingUpEventTracking\n   * @link https://developers.google.com/analytics/devguides/collection/analyticsjs/events\n   */\n  eventTrack(action: string, properties: any) {\n    // Google Analytics requires an Event Category\n    if (!properties || !properties.category) {\n      properties = properties || {};\n      properties.category = 'Event';\n    }\n    // GA requires that eventValue be an integer, see:\n    // https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#eventValue\n    // https://github.com/luisfarzati/angulartics/issues/81\n    if (properties.value) {\n      const parsed = parseInt(properties.value, 10);\n      properties.value = isNaN(parsed) ? 0 : parsed;\n    }\n\n    if (typeof ga !== 'undefined') {\n      const eventOptions = {\n        eventCategory: properties.category,\n        eventAction: action,\n        eventLabel: properties.label,\n        eventValue: properties.value,\n        nonInteraction: properties.noninteraction,\n        page: properties.page || location.hash.substring(1) || location.pathname,\n        userId: this.angulartics2.settings.ga.userId,\n        hitCallback: properties.hitCallback,\n      };\n\n      // add custom dimensions and metrics\n      this.setDimensionsAndMetrics(properties);\n      if (this.angulartics2.settings.ga.transport) {\n        ga('send', 'event', eventOptions, {\n          transport: this.angulartics2.settings.ga.transport,\n        });\n      } else {\n        ga('send', 'event', eventOptions);\n      }\n\n      for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n        ga(accountName + '.send', 'event', eventOptions);\n      }\n    } else if (typeof _gaq !== 'undefined') {\n      _gaq.push([\n        '_trackEvent',\n        properties.category,\n        action,\n        properties.label,\n        properties.value,\n        properties.noninteraction,\n      ]);\n    }\n  }\n\n  /**\n   * Exception Track Event in GA\n   *\n   * @param properties Comprised of the optional fields:\n   *  - fatal (string)\n   *  - description (string)\n   *\n   * @https://developers.google.com/analytics/devguides/collection/analyticsjs/exceptions\n   *\n   * @link https://developers.google.com/analytics/devguides/collection/analyticsjs/events\n   */\n  exceptionTrack(properties: any) {\n    if (properties.fatal === undefined) {\n      console.log('No \"fatal\" provided, sending with fatal=true');\n      properties.fatal = true;\n    }\n\n    properties.exDescription = properties.description;\n\n    const eventOptions = {\n      exFatal: properties.fatal,\n      exDescription: properties.description,\n    };\n\n    ga('send', 'exception', eventOptions);\n    for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n      ga(accountName + '.send', 'exception', eventOptions);\n    }\n  }\n\n  /**\n   * User Timings Event in GA\n   * @name userTimings\n   *\n   * @param properties Comprised of the mandatory fields:\n   *  - timingCategory (string)\n   *  - timingVar (string)\n   *  - timingValue (number)\n   * Properties can also have the optional fields:\n   *  - timingLabel (string)\n   *\n   * @link https://developers.google.com/analytics/devguides/collection/analyticsjs/user-timings\n   */\n  userTimings(properties: UserTimings) {\n    if (\n      !properties ||\n      !properties.timingCategory ||\n      !properties.timingVar ||\n      !properties.timingValue\n    ) {\n      console.error(\n        'Properties timingCategory, timingVar, and timingValue are required to be set.',\n      );\n      return;\n    }\n\n    if (typeof ga !== 'undefined') {\n      ga('send', 'timing', properties);\n      for (const accountName of this.angulartics2.settings.ga.additionalAccountNames) {\n        ga(accountName + '.send', 'timing', properties);\n      }\n    }\n  }\n\n  setUsername(userId: string) {\n    this.angulartics2.settings.ga.userId = userId;\n    if (typeof ga === 'undefined') {\n      return;\n    }\n    ga('set', 'userId', userId);\n  }\n\n  setUserProperties(properties: any) {\n    this.setDimensionsAndMetrics(properties);\n  }\n\n  private setDimensionsAndMetrics(properties: any) {\n    if (typeof ga === 'undefined') {\n      return;\n    }\n    // clean previously used dimensions and metrics that will not be overriden\n    this.dimensionsAndMetrics.forEach(elem => {\n      if (!properties.hasOwnProperty(elem)) {\n        ga('set', elem, undefined);\n\n        this.angulartics2.settings.ga.additionalAccountNames.forEach(\n          (accountName: string) => {\n            ga(`${accountName}.set`, elem, undefined);\n          },\n        );\n      }\n    });\n    this.dimensionsAndMetrics = [];\n\n    // add custom dimensions and metrics\n    Object.keys(properties).forEach(key => {\n      if (\n        key.lastIndexOf('dimension', 0) === 0 ||\n        key.lastIndexOf('metric', 0) === 0\n      ) {\n        ga('set', key, properties[key]);\n\n        this.angulartics2.settings.ga.additionalAccountNames.forEach(\n          (accountName: string) => {\n            ga(`${accountName}.set`, key, properties[key]);\n          },\n        );\n        this.dimensionsAndMetrics.push(key);\n      }\n    });\n  }\n}\n"
  ],
  "names": [
    "tslib_1.__values",
    "angulartics2"
  ],
  "mappings": "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"
}
